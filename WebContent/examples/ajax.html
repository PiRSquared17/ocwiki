<head>
<title>AJAX with Prototype Example</title>
<script src="prototype.js"></script>
</head>
<body>

<form>
<p>
<button type="submit" onclick="listQuestions(); return false;">Danh sách câu hỏi</button>
</p>
</form>

<form>
<p>
<input type="text" id="qid" value="Mã câu hỏi">
<button type="submit" onclick="viewQuestion($F('qid')); return false;">Xem câu hỏi</button>
</p>
</form>

<form>
<p>
<input type="text" id="qid2" value="Mã câu hỏi">
<button type="submit" onclick="listAnswers($F('qid2')); return false;">Danh sách câu trả lời</button>
</p>
</form>

<form>
<p>
<input type="text" id="aid" value="Mã câu trả lời">
<button type="submit" onclick="viewAnswer($F('aid')); return false;">Xem câu trả lời</button>
</p>
</form>

<form id="aform" method="post">
<p>
<input type="text" id="aid2" value="Mã câu trả lời">
<input type="text" id="content" name="content" value="Nội dung">
<label><input type="checkbox" id="correct" name="correct" value="true">Đúng</label>
<button type="submit" onclick="updateAnswer($('aform'), $F('aid2')); return false;">Sửa câu trả lời</button>
</p>
</form>

<script>

var restPath = 'http://localhost:8080/ocwiki/rest';

function viewQuestion(id) {
	new Ajax.Request(restPath + '/questions/' + id, {
		method: 'get',
		requestHeaders: {Accept: 'application/json'},
		evalJSON: true,
		onSuccess: function(transport) {
		    var question = transport.responseJSON.result;
			alert('- ID: ' + question.id + '\n' +
			        '- Nội dung câu hỏi: ' + question.content.text);
		},
		onFailure: function(transport) {
			alert('Câu hỏi không tồn tại\n' + response.text);
		}
	});
}

function listQuestions() {
    new Ajax.Request(restPath + '/questions', {
        method: 'get',
        requestHeaders: {Accept: 'application/json'},
        evalJSON: true,
        onSuccess: function(transport) {
            var str = '';
            var questions = transport.responseJSON.result;
            questions.each(function (value, index) {
                str += '- ' + value.id + '\n';                
            });            
            alert(str);
        },
        onFailure: function(transport) {
        }
    });
}

function listAnswers(qid) {
    new Ajax.Request(restPath + '/answers/question/' + qid, {
        method: 'get',
        requestHeaders: {Accept: 'application/json'},
        evalJSON: true,
        onSuccess: function(transport) {
            var str = '';
            var questions = transport.responseJSON.result;
            questions.each(function (value, index) {
                str += '- ' + value.id + '\n';                
            });            
            alert(str);
        },
        onFailure: function(transport) {
            alert('Câu hỏi không tồn tại\n' + response.text);
        }
    });
}

function viewAnswer(aid) {
    new Ajax.Request(restPath + '/answers/' + aid, {
        method: 'get',
        requestHeaders: {Accept: 'application/json'},
        evalJSON: true,
        onSuccess: function(transport) {
            var answer = transport.responseJSON.result;
            alert('ID: ' + answer.id + '\n' +
                    'Nội dung: ' + answer.content.text + '\n' +
                    'Đúng: ' + answer.correct);
        },
        onFailure: function(transport) {
            alert('Câu trả lời không tồn tại\n' + response.text);
        }
    });
}

function updateAnswer2(form, id) {
	form.action = restPath + '/answers/' + id;
    form.request({
        requestHeaders: {Accept: 'application/json'},
        evalJSON: true,
        onSuccess: function(transport) {
            var answer = transport.responseJSON.result;
            alert('ID: ' + answer.id + '\n' +
                    'Nội dung: ' + answer.content.text + '\n' +
                    'Đúng: ' + answer.correct);
        },
        onFailure: function(transport) {
            alert('Câu trả lời không tồn tại\n' + response.text);
        }
    });
}

</script>

</body>
